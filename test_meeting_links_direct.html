<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Meeting Links Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { border: 1px solid #ddd; padding: 20px; margin: 15px 0; border-radius: 8px; background: #f9f9f9; }
        .request-item { padding: 15px; border-bottom: 1px solid #f1f5f9; transition: all 0.3s ease; background: white; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .request-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .request-info h4 { margin: 0 0 5px 0; color: #1e293b; font-weight: 600; font-size: 1rem; }
        .request-meta { display: flex; gap: 12px; font-size: 0.85rem; color: #64748b; flex-wrap: wrap; }
        .request-meta span { display: flex; align-items: center; gap: 4px; }
        .request-status { font-weight: 600; }
        .status-pending { color: #f59e0b; }
        .status-accepted { color: #10b981; }
        .status-rejected { color: #ef4444; }
        .request-date { font-size: 0.8rem; color: #94a3b8; }
        .request-actions { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
        .chat-btn { background: #10b981; color: white; border: none; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 5px; }
        .chat-btn:hover { background: #059669; }
        .meeting-link { margin-top: 12px; padding: 12px; background: #e0f2fe; border-radius: 8px; border-left: 4px solid #0284c7; }
        .meeting-link-btn { display: inline-flex; align-items: center; gap: 8px; background: #0284c7; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; margin-top: 8px; transition: background-color 0.2s; }
        .meeting-link-btn:hover { background: #0369a1; color: white; }
        .meeting-info { font-size: 0.8rem; color: #64748b; margin-top: 8px; }
        .response-message { margin-top: 8px; padding: 8px 12px; background: #f1f5f9; border-radius: 6px; font-size: 0.9rem; color: #475569; }
        .error { color: red; background: #fee2e2; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { color: green; background: #d1fae5; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .info { color: blue; background: #dbeafe; padding: 10px; border-radius: 4px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; background: #3b82f6; color: white; }
        button:hover { background: #2563eb; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Direct Meeting Links Test</h1>
        <p>This test directly calls the API and renders meeting links exactly like the dashboard should.</p>
        
        <div class="test-section">
            <h2>Step 1: Login and Get Token</h2>
            <button onclick="loginAsClient()">Login as Client</button>
            <button onclick="loginAsLawyer()">Login as Lawyer</button>
            <div id="loginStatus"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 2: Fetch Requests Data</h2>
            <button onclick="fetchClientRequests()">Fetch Client Requests</button>
            <button onclick="fetchLawyerRequests()">Fetch Lawyer Requests</button>
            <div id="fetchStatus"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 3: Render Meeting Links (Client View)</h2>
            <div id="clientRequestsDisplay"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 4: Render Meeting Links (Lawyer View)</h2>
            <div id="lawyerRequestsDisplay"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 5: Raw API Data</h2>
            <button onclick="showRawData()">Show Raw API Response</button>
            <pre id="rawDataDisplay"></pre>
        </div>
    </div>

    <script>
        const API_BASE_URL = window.location.hostname === 'localhost' ? 
            'http://localhost:8001/api' : 
            'https://jai-production-5c01.up.railway.app/api';
        
        let clientToken = null;
        let lawyerToken = null;
        let clientRequestsData = null;
        let lawyerRequestsData = null;

        async function loginAsClient() {
            const statusDiv = document.getElementById('loginStatus');
            statusDiv.innerHTML = '<div class="info">Logging in as client...</div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'client@test.com',
                        password: 'password123'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    clientToken = data.access_token;
                    statusDiv.innerHTML += '<div class="success">‚úÖ Client login successful!</div>';
                } else {
                    statusDiv.innerHTML += `<div class="error">‚ùå Client login failed: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="error">‚ùå Client login error: ${error.message}</div>`;
            }
        }

        async function loginAsLawyer() {
            const statusDiv = document.getElementById('loginStatus');
            statusDiv.innerHTML = '<div class="info">Logging in as lawyer...</div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'lawyer@test.com',
                        password: 'password123'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    lawyerToken = data.access_token;
                    statusDiv.innerHTML += '<div class="success">‚úÖ Lawyer login successful!</div>';
                } else {
                    statusDiv.innerHTML += `<div class="error">‚ùå Lawyer login failed: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="error">‚ùå Lawyer login error: ${error.message}</div>`;
            }
        }

        async function fetchClientRequests() {
            const statusDiv = document.getElementById('fetchStatus');
            
            if (!clientToken) {
                statusDiv.innerHTML = '<div class="error">‚ùå Please login as client first</div>';
                return;
            }
            
            statusDiv.innerHTML = '<div class="info">Fetching client requests...</div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/requests/`, {
                    headers: { 'Authorization': `Bearer ${clientToken}` }
                });
                
                if (response.ok) {
                    clientRequestsData = await response.json();
                    statusDiv.innerHTML += `<div class="success">‚úÖ Fetched ${clientRequestsData.length} client requests</div>`;
                    renderClientRequests();
                } else {
                    statusDiv.innerHTML += `<div class="error">‚ùå Failed to fetch client requests: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="error">‚ùå Client requests error: ${error.message}</div>`;
            }
        }

        async function fetchLawyerRequests() {
            const statusDiv = document.getElementById('fetchStatus');
            
            if (!lawyerToken) {
                statusDiv.innerHTML = '<div class="error">‚ùå Please login as lawyer first</div>';
                return;
            }
            
            statusDiv.innerHTML = '<div class="info">Fetching lawyer requests...</div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/requests/`, {
                    headers: { 'Authorization': `Bearer ${lawyerToken}` }
                });
                
                if (response.ok) {
                    lawyerRequestsData = await response.json();
                    statusDiv.innerHTML += `<div class="success">‚úÖ Fetched ${lawyerRequestsData.length} lawyer requests</div>`;
                    renderLawyerRequests();
                } else {
                    statusDiv.innerHTML += `<div class="error">‚ùå Failed to fetch lawyer requests: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="error">‚ùå Lawyer requests error: ${error.message}</div>`;
            }
        }

        function renderClientRequests() {
            const container = document.getElementById('clientRequestsDisplay');
            
            if (!clientRequestsData || clientRequestsData.length === 0) {
                container.innerHTML = '<div class="info">No client requests to display</div>';
                return;
            }

            // Use the exact same logic as the client dashboard
            container.innerHTML = clientRequestsData.map(function(request) {
                const statusClass = request.status === 'pending' ? 'status-pending' : 
                                  request.status === 'accepted' ? 'status-accepted' : 'status-rejected';
                
                const statusIcon = request.status === 'pending' ? 'clock' : 
                                 request.status === 'accepted' ? 'check-circle' : 'times-circle';
                
                const showChatButton = request.status === 'accepted' || request.status === 'rejected';
                
                return `
                    <div class="request-item">
                        <div class="request-header">
                            <div class="request-info">
                                <h4>${request.title}</h4>
                                <div class="request-meta">
                                    <span>üë®‚Äçüíº ${request.lawyer_name}</span>
                                    <span>üè∑Ô∏è ${request.category}</span>
                                    <span class="request-status ${statusClass}">
                                        üìä ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                                    </span>
                                </div>
                            </div>
                            <div class="request-actions">
                                ${showChatButton ? `
                                    <button class="chat-btn" onclick="alert('Chat functionality')" title="Open Chat">
                                        üí¨ Chat
                                    </button>
                                ` : ''}
                                <div class="request-date">
                                    ${new Date(request.created_at).toLocaleDateString()}
                                </div>
                            </div>
                        </div>
                        ${request.meeting_link ? `
                            <div class="meeting-link">
                                <strong>üîó Meeting Link:</strong>
                                <a href="${request.meeting_link.join_url}" target="_blank" class="meeting-link-btn">
                                    üé• Join Meeting
                                </a>
                                <div class="meeting-info">
                                    Provider: ${request.meeting_link.provider} | Created: ${new Date(request.meeting_link.created_at).toLocaleDateString()}
                                </div>
                            </div>
                        ` : '<div class="info" style="margin-top: 10px; padding: 8px; background: #fef3c7; border-radius: 4px;">‚ö†Ô∏è No meeting link available for this request</div>'}
                        ${request.response_message ? `
                            <div class="response-message">
                                <strong>Response:</strong> ${request.response_message}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderLawyerRequests() {
            const container = document.getElementById('lawyerRequestsDisplay');
            
            if (!lawyerRequestsData || lawyerRequestsData.length === 0) {
                container.innerHTML = '<div class="info">No lawyer requests to display</div>';
                return;
            }

            container.innerHTML = lawyerRequestsData.map(function(request) {
                const statusClass = request.status === 'pending' ? 'status-pending' : 
                                  request.status === 'accepted' ? 'status-accepted' : 'status-rejected';
                
                return `
                    <div class="request-item">
                        <div class="request-header">
                            <div class="request-info">
                                <h4>${request.title}</h4>
                                <div class="request-meta">
                                    <span>üë§ ${request.client_name}</span>
                                    <span>üè∑Ô∏è ${request.category}</span>
                                    <span class="request-status ${statusClass}">
                                        üìä ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                                    </span>
                                </div>
                            </div>
                            <div class="request-actions">
                                <div class="request-date">
                                    ${new Date(request.created_at).toLocaleDateString()}
                                </div>
                            </div>
                        </div>
                        ${request.meeting_link ? `
                            <div class="meeting-link">
                                <strong>üîó Meeting Link Generated:</strong>
                                <a href="${request.meeting_link.join_url}" target="_blank" class="meeting-link-btn">
                                    üé• Join Meeting
                                </a>
                                <div class="meeting-info">
                                    Provider: ${request.meeting_link.provider} | Meeting ID: ${request.meeting_link.meeting_id} | Created: ${new Date(request.meeting_link.created_at).toLocaleDateString()}
                                </div>
                            </div>
                        ` : '<div class="info" style="margin-top: 10px; padding: 8px; background: #fef3c7; border-radius: 4px;">‚ö†Ô∏è No meeting link available for this request</div>'}
                        ${request.response_message ? `
                            <div class="response-message">
                                <strong>Response:</strong> ${request.response_message}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function showRawData() {
            const display = document.getElementById('rawDataDisplay');
            display.textContent = JSON.stringify({
                clientRequests: clientRequestsData,
                lawyerRequests: lawyerRequestsData
            }, null, 2);
        }
    </script>
</body>
</html>