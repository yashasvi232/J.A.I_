<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Dashboard Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { border: 1px solid #ddd; padding: 20px; margin: 15px 0; border-radius: 8px; background: #f9f9f9; }
        .error { color: red; background: #fee2e2; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { color: green; background: #d1fae5; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .info { color: blue; background: #dbeafe; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .warning { color: orange; background: #fef3c7; padding: 10px; border-radius: 4px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; background: #3b82f6; color: white; }
        button:hover { background: #2563eb; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; border: 1px solid #ddd; max-height: 300px; overflow-y: auto; }
        .meeting-link { margin: 10px 0; padding: 12px; background: #e0f2fe; border-radius: 8px; border-left: 4px solid #0284c7; }
        .meeting-link-btn { display: inline-flex; align-items: center; gap: 8px; background: #0284c7; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; margin-top: 8px; }
        .request-item { background: white; border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .status-accepted { color: #10b981; font-weight: bold; }
        .status-pending { color: #f59e0b; font-weight: bold; }
        .status-rejected { color: #ef4444; font-weight: bold; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Live Dashboard Test</h1>
        <p>Testing the actual dashboard with live backend server.</p>
        
        <div class="test-section">
            <h2>Step 1: Test API Connection</h2>
            <button onclick="testAPI()">Test API</button>
            <div id="apiResults"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 2: Login and Get Meeting Links</h2>
            <button onclick="testMeetingLinks()">Test Meeting Links</button>
            <div id="meetingResults"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 3: Load Actual Dashboard</h2>
            <button onclick="loadDashboard()">Load Client Dashboard</button>
            <div id="dashboardFrame"></div>
        </div>
        
        <div class="test-section">
            <h2>Step 4: JavaScript Console Check</h2>
            <div class="info">
                <strong>Instructions:</strong><br>
                1. Open browser Developer Tools (F12)<br>
                2. Go to Console tab<br>
                3. Load the dashboard above<br>
                4. Login with: client@test.com / password123<br>
                5. Look for any red error messages<br>
                6. Check if meeting links appear
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8001/api';
        
        async function testAPI() {
            const results = document.getElementById('apiResults');
            results.innerHTML = '<div class="info">Testing API connection...</div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'test', password: 'test' })
                });
                
                if (response.status === 422 || response.status === 401) {
                    results.innerHTML = '<div class="success">‚úÖ API is reachable and responding correctly</div>';
                } else {
                    results.innerHTML = `<div class="warning">‚ö†Ô∏è API responding but unexpected status: ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå API connection failed: ${error.message}</div>`;
            }
        }

        async function testMeetingLinks() {
            const results = document.getElementById('meetingResults');
            results.innerHTML = '<div class="info">Testing meeting links...</div>';
            
            try {
                // Login as client
                const loginResponse = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'client@test.com',
                        password: 'password123'
                    })
                });
                
                if (!loginResponse.ok) {
                    results.innerHTML += '<div class="error">‚ùå Login failed</div>';
                    return;
                }
                
                const loginData = await loginResponse.json();
                const token = loginData.access_token;
                results.innerHTML += '<div class="success">‚úÖ Login successful</div>';
                
                // Get requests
                const requestsResponse = await fetch(`${API_BASE_URL}/requests/`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!requestsResponse.ok) {
                    results.innerHTML += '<div class="error">‚ùå Failed to fetch requests</div>';
                    return;
                }
                
                const requests = await requestsResponse.json();
                results.innerHTML += `<div class="success">‚úÖ Fetched ${requests.length} requests</div>`;
                
                // Check for meeting links
                const requestsWithMeetingLinks = requests.filter(req => req.meeting_link);
                results.innerHTML += `<div class="info">üìã Requests with meeting links: ${requestsWithMeetingLinks.length}</div>`;
                
                requestsWithMeetingLinks.forEach(req => {
                    results.innerHTML += `
                        <div class="success">
                            ‚úÖ Found meeting link in "${req.title}":<br>
                            - URL: ${req.meeting_link.join_url}<br>
                            - Provider: ${req.meeting_link.provider}<br>
                            - Meeting ID: ${req.meeting_link.meeting_id}
                        </div>
                    `;
                });
                
                if (requestsWithMeetingLinks.length === 0) {
                    results.innerHTML += '<div class="error">‚ùå No meeting links found in API data!</div>';
                } else {
                    results.innerHTML += '<div class="success">‚úÖ Meeting links found in API! Issue is likely in UI rendering.</div>';
                }
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function loadDashboard() {
            const frame = document.getElementById('dashboardFrame');
            frame.innerHTML = '<iframe src="http://localhost:8001/pages/client-dashboard.html"></iframe>';
        }

        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                testAPI();
            }, 1000);
        });
    </script>
</body>
</html>